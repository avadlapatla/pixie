import{r as e,a as t,R as r}from"./vendor-3192ac2a.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var o={exports:{}},s={},n=e,l=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,c=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,r){var o,s={},n=null,a=null;for(o in void 0!==r&&(n=""+r),void 0!==t.key&&(n=""+t.key),void 0!==t.ref&&(a=t.ref),t)i.call(t,o)&&!d.hasOwnProperty(o)&&(s[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===s[o]&&(s[o]=t[o]);return{$$typeof:l,type:e,key:n,ref:a,props:s,_owner:c.current}}s.Fragment=a,s.jsx=u,s.jsxs=u,o.exports=s;var h=o.exports,m={},f=t;m.createRoot=f.createRoot,m.hydrateRoot=f.hydrateRoot;const p={},x={}.VITE_API_BASE||"",y=()=>localStorage.getItem("token"),g=async(e,t={})=>{const r=y(),o={...t.headers,...r?{Authorization:`Bearer ${r}`}:{}};return fetch(`${x}${e}`,{...t,headers:o})},j=e=>`${x}/photo/${e}`,b=({onPhotoClick:t,newPhoto:r})=>{const[o,s]=e.useState([]),[n,l]=e.useState(!0),[a,i]=e.useState(null);return e.useEffect((()=>{(async()=>{try{l(!0);const e=await(async()=>{const e=await g("/photos");if(!e.ok)throw new Error(`Failed to fetch photos: ${e.statusText}`);return(await e.json()).photos})();s(e),i(null)}catch(e){i("Failed to load photos. Please check your connection and try again.")}finally{l(!1)}})()}),[]),e.useEffect((()=>{r&&s((e=>[r,...e]))}),[r]),n?h.jsx("div",{className:"flex justify-center items-center h-64",children:h.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):a?h.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[h.jsx("strong",{className:"font-bold",children:"Error!"}),h.jsxs("span",{className:"block sm:inline",children:[" ",a]})]}):0===o.length?h.jsx("div",{className:"text-center py-10",children:h.jsx("p",{className:"text-gray-500",children:"No photos yet. Upload your first photo!"})}):h.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:o.map((e=>h.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden cursor-pointer transform transition-transform hover:scale-105",onClick:()=>t(e),children:[h.jsx("img",{src:j(e.id),alt:e.filename,className:"w-full h-48 object-cover",loading:"lazy"}),h.jsxs("div",{className:"p-3",children:[h.jsx("p",{className:"text-sm text-gray-700 truncate",children:e.filename}),h.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleDateString()})]})]},e.id)))})},w=({onUploadSuccess:t})=>{const[r,o]=e.useState(!1),[s,n]=e.useState(null),l=e.useRef(null);return h.jsxs("div",{className:"mb-6",children:[h.jsx("input",{type:"file",ref:l,onChange:async e=>{const r=e.target.files;if(!r||0===r.length)return;const s=r[0];l.current&&(l.current.value="");try{o(!0),n(null);const e=await(async e=>{const t=new FormData;t.append("file",e);const r=await g("/upload",{method:"POST",body:t});if(!r.ok)throw new Error(`Failed to upload photo: ${r.statusText}`);return r.json()})(s);t(e)}catch(a){n("Failed to upload photo. Please try again."),console.error("Upload error:",a)}finally{o(!1)}},accept:"image/*",className:"hidden"}),h.jsx("button",{onClick:()=>{l.current&&l.current.click()},disabled:r,className:"w-full py-2 px-4 rounded-md text-white font-medium transition-colors "+(r?"bg-blue-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"),children:r?h.jsxs("span",{className:"flex items-center justify-center",children:[h.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[h.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),h.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Uploading..."]}):"Upload Photo"}),s&&h.jsx("div",{className:"mt-2 text-sm text-red-600",children:s})]})},v=e.lazy((()=>function(e,t,r){if(!t||0===t.length)return e();const o=document.getElementsByTagName("link");return Promise.all(t.map((e=>{if((e=function(e){return"/"+e}(e))in p)return;p[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(r)for(let r=o.length-1;r>=0;r--){const s=o[r];if(s.href===e&&(!t||"stylesheet"===s.rel))return}else if(document.querySelector(`link[href="${e}"]${s}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script",n.crossOrigin=""),n.href=e,document.head.appendChild(n),t?new Promise(((t,r)=>{n.addEventListener("load",t),n.addEventListener("error",(()=>r(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e())).catch((e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}))}((()=>import("./Lightbox-8aa10c86.js")),["assets/Lightbox-8aa10c86.js","assets/vendor-3192ac2a.js"])));function N(){const[t,r]=e.useState(!!y()),[o,s]=e.useState(""),[n,l]=e.useState(null),[a,i]=e.useState(null),c=e=>{e.preventDefault(),o.trim()&&((e=>{localStorage.setItem("token",e)})(o.trim()),r(!0))};return t?h.jsxs("div",{className:"container mx-auto px-4 py-8",children:[h.jsx("header",{className:"mb-8",children:h.jsx("h1",{className:"text-3xl font-bold text-center",children:"Pixie Photo Gallery"})}),h.jsx(w,{onUploadSuccess:e=>{i(e)}}),h.jsx(b,{onPhotoClick:e=>{l(e)},newPhoto:a}),h.jsx(e.Suspense,{fallback:h.jsx("div",{children:"Loading..."}),children:h.jsx(v,{photo:n,onClose:()=>{l(null)}})})]}):h.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 p-4",children:h.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-md p-8",children:[h.jsx("h1",{className:"text-2xl font-bold text-center mb-6",children:"Pixie Photo Gallery"}),h.jsxs("form",{onSubmit:c,children:[h.jsxs("div",{className:"mb-4",children:[h.jsx("label",{htmlFor:"token",className:"block text-gray-700 text-sm font-bold mb-2",children:"JWT Token"}),h.jsx("input",{type:"text",id:"token",value:o,onChange:e=>s(e.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",placeholder:"Enter your JWT token",required:!0})]}),h.jsx("div",{className:"flex items-center justify-center",children:h.jsx("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Sign In"})})]})]})})}m.createRoot(document.getElementById("root")).render(h.jsx(r.StrictMode,{children:h.jsx(N,{})}));export{j as g,h as j};
